<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>DIVAS Vignette: Toy Dataset Example • DIVAS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="DIVAS Vignette: Toy Dataset Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DIVAS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/DIVAS_Toy_Dataset_Example.html">Toy Dataset Example</a></li>
    <li><a class="dropdown-item" href="../articles/DIVAS_GNP_Dataset_Example.html">GNP Dataset Example</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ByronSyun/DIVAS_Develop" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>DIVAS Vignette: Toy Dataset Example</h1>
                        <h4 data-toc-skip class="author">Yinuo Sun</h4>
            
            <h4 data-toc-skip class="date">2025-07-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ByronSyun/DIVAS_Develop/blob/main/vignettes/DIVAS_Toy_Dataset_Example.Rmd" class="external-link"><code>vignettes/DIVAS_Toy_Dataset_Example.Rmd</code></a></small>
      <div class="d-none name"><code>DIVAS_Toy_Dataset_Example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This guide demonstrates how to use the <code>DIVAS</code> R package
to perform data integration on a provided toy dataset. DIVAS (Data
Integration via Analysis of Subspaces) identifies joint and individual
variation patterns across multiple data blocks (modalities).</p>
<p>First, ensure you have the <code>DIVAS</code> package and its
dependencies installed. See the main <code>README.md</code> for
installation instructions, especially regarding the required
<code>CVXR</code> version (0.99-7).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install if not have</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span></span>
<span><span class="co"># Install DIVAS package from GitHub</span></span>
<span><span class="co"># devtools::install_github("ByronSyun/DIVAS_Develop", ref = "DIVAS-v1")</span></span>
<span></span>
<span><span class="co"># Or install from local folder</span></span>
<span><span class="co"># devtools::load_all("DIVAS-main") </span></span>
<span></span>
<span><span class="co"># Install the specified version of CVXR</span></span>
<span><span class="co"># devtools::install_version("CVXR", version = "0.99-7", repos = "http://cran.us.r-project.org")</span></span>
<span></span>
<span><span class="co"># For pkgdown, libraries are generally not needed here if the package is loaded,</span></span>
<span><span class="co"># # library(R.matlab)</span></span>
<span><span class="co"># # library(DIVAS)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-toy-dataset-toydatathreeway-mat">The Toy Dataset (<code>toyDataThreeWay.mat</code>)<a class="anchor" aria-label="anchor" href="#the-toy-dataset-toydatathreeway-mat"></a>
</h2>
<p>The toy dataset (<code>toyDataThreeWay.mat</code>) is used to test
DIVAS by the original author. It’s stored in MATLAB format.</p>
<p>This dataset contains a variable named <code>datablock</code>, which
is a MATLAB cell array with dimensions 1×3. Inside R, after loading with
<code><a href="https://rdrr.io/pkg/R.matlab/man/readMat.html" class="external-link">readMat()</a></code>, it becomes a nested list structure with three
elements, each containing a data matrix. It also includes a
<code>dataname</code> variable that provides labels (“X1”, “X2”, “X3”)
for these data blocks.</p>
<p>The three data matrices have the following dimensions: - Block 1
(X1): 200 × 400 matrix - Block 2 (X2): 400 × 400 matrix - Block 3 (X3):
10000 × 400 matrix</p>
<p>These matrices share a common dimension (400 columns), representing
400 samples measured using three different modalities, where each
modality captures a different number of features (200, 400, and 10000
respectively). This structure is typical in multi-modal data integration
scenarios, where the same samples are profiled using different
measurement techniques.</p>
<p>Let’s load the data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(R.matlab)</span></span>
<span><span class="co"># Assuming 'toyDataThreeWay.mat' is in your working directory or data/ directory of the package</span></span>
<span><span class="co"># data_path &lt;- system.file("extdata", "toyDataThreeWay.mat", package = "DIVAS") </span></span>
<span><span class="co"># data &lt;- R.matlab::readMat(data_path) </span></span>
<span><span class="co"># str(data$datablock)</span></span></code></pre></div>
<p>The <code>datablock</code> object loaded from the <code>.mat</code>
file needs to be converted into a simple list of matrices, where each
element of the list is one data block (matrix).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># datablock_list &lt;- list(</span></span>
<span><span class="co">#   Block1 = data$datablock[1,1][[1]][[1]],</span></span>
<span><span class="co">#   Block2 = data$datablock[1,2][[1]][[1]],</span></span>
<span><span class="co">#   Block3 = data$datablock[1,3][[1]][[1]]</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># print(paste("Block 1 dimensions:", dim(datablock_list[[1]])))</span></span>
<span><span class="co"># print(paste("Block 2 dimensions:", dim(datablock_list[[2]])))</span></span>
<span><span class="co"># print(paste("Block 3 dimensions:", dim(datablock_list[[3]])))</span></span></code></pre></div>
<p>Now, <code>datablock_list</code> is ready for DIVAS analysis. It
contains three matrices.</p>
</div>
<div class="section level2">
<h2 id="running-divas-analysis">Running DIVAS Analysis<a class="anchor" aria-label="anchor" href="#running-divas-analysis"></a>
</h2>
<p>The core function is <code>DIVASmain</code>. We pass our prepared
list of data blocks to it.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the main DIVAS function</span></span>
<span><span class="co"># Use default parameters for this example</span></span>
<span><span class="co"># divas_results &lt;- DIVAS::DIVASmain(datablock_list)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # The result is a list containing various outputs</span></span>
<span><span class="co"># names(divas_results)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="divas-analysis-process-and-results-interpretation">DIVAS Analysis Process and Results Interpretation<a class="anchor" aria-label="anchor" href="#divas-analysis-process-and-results-interpretation"></a>
</h2>
<p>The DIVAS analysis performed by <code><a href="../reference/DIVASmain.html">DIVASmain()</a></code> consists of
three main steps:</p>
<div class="section level3">
<h3 id="step-1-signal-extraction">Step 1: Signal Extraction<a class="anchor" aria-label="anchor" href="#step-1-signal-extraction"></a>
</h3>
<p>The first step extracts the signal component from each data block by
separating it from noise. When you run <code><a href="../reference/DIVASmain.html">DIVASmain()</a></code>, you’ll
see output similar to:</p>
<pre><code>Signal estimation for X1
Datablock dimensions: 200 features; 400 samples 
estimated noise = 19.96 
Initial signal rank for X1 is 3.
Progress Through Bootstrapped Matrices:
...
Culled Rank is 3.
Perturbation Angle for X1 is 11.8.</code></pre>
<p>For each data block, this step:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Estimates the noise level</strong> using random matrix
theory</li>
<li>
<strong>Determines an initial signal rank</strong> based on singular
values above the noise threshold</li>
<li>
<strong>Refines the rank through bootstrapping</strong> (sampling
with replacement)</li>
<li>
<strong>Calculates a perturbation angle</strong>, which indicates
how stable the extracted signal subspace is</li>
</ol>
<p>In our toy example, all three data blocks have: - <strong>Culled Rank
= 3</strong>: The algorithm detected three significant components in
each data block - <strong>Perturbation Angles</strong> (11.8, 8.6, and
2.8 for X1, X2, and X3): These values indicate the stability of the
extracted signals. Smaller angles suggest more stable signals,
explaining why X3 (with 10,000 features) has the most stable signal
extraction.</p>
<p>The output from this step, the signal matrices, becomes the input for
the joint structure identification step.</p>
</div>
<div class="section level3">
<h3 id="step-2-joint-structure-identification">Step 2: Joint Structure Identification<a class="anchor" aria-label="anchor" href="#step-2-joint-structure-identification"></a>
</h3>
<p>The second step identifies joint and individual structure components
across the data blocks. DIVAS uses convex optimization to find subspaces
that are shared between different combinations of data blocks, as well
as subspaces that are unique to individual blocks.</p>
<p>This step is computationally intensive as it involves solving a
penalized optimization problem. When running, you’ll see output similar
to:</p>
<pre><code>Joint structure estimation for block: 1, 2, 3
Solving for structures with key: 1
Solving for structures with key: 2
Solving for structures with key: 3
Solving for structures with key: 4
...
Solving for structures with key: 7
Joint structure estimate for 1, 2, 3 complete.</code></pre>
<p>During this step, the algorithm performs iterative convex
optimization to identify joint and individual structures. For each
structure key, you’ll see output like:</p>
<pre><code>Find joint structure shared only among X1, X2, X3.
Search Direction 1:
2 0.903132 0.953589 1.004182 2.990696 0.995363 -1000005.482454
3 0.796711 0.845383 0.894077 2.767596 0.885542 0.162749
4 0.701401 0.748269 0.795147 2.561086 0.786920 0.154449
...
Iteration 10
10 0.307495 0.345173 0.382800 1.602823 0.376174 0.111738
...
Iteration 20
20 0.041978 0.069198 0.096336 0.696604 0.091532 0.060549
...</code></pre>
<p>This output represents the optimization progress where: -
<strong>Column 1</strong>: Iteration number - <strong>Columns
2-4</strong>: Slack variables for each data block (X1, X2, X3), which
measure constraint violations for each block - <strong>Column
5</strong>: Sum of the slack variables, representing total constraint
violation - <strong>Column 6</strong>: Represents the norm constraint
slack variable (ensuring the solution vector has unit norm) -
<strong>Column 7</strong>: Objective function change between successive
iterations (decrease in objective value, first one as negative
infinity).</p>
<p>The algorithm is using a penalty method with slack variables to solve
a constrained optimization problem. As the iterations progress, you
should observe: 1. Decreasing slack values (columns 2-5), indicating
constraints are being better satisfied 2. Smaller changes in the
objective function (column 7), indicating convergence.</p>
<p>The optimization stops when both the change in objective value and
the sum of slack variables fall below specified thresholds, indicating
that a stable solution has been found.</p>
<p>Additionally, you’ll notice the algorithm searches for multiple
directions within each structure:</p>
<pre><code>Search Direction 1:
...
Direction 1 converges.
There is room for searching next direction. Continue...

Search Direction 2:
...
Direction 2 does not converge. Stop searching current joint block.

Find joint structure shared only among X1, X2.
Search Direction 1:
...</code></pre>
<p>This sequence shows how DIVAS finds the basis vectors for each
structure:</p>
<ol style="list-style-type: decimal">
<li><p>For each joint structure (e.g., “structure shared among X1, X2,
X3”), the algorithm searches for orthogonal directions
sequentially.</p></li>
<li><p>Each “Search Direction” represents an attempt to find one basis
vector of the subspace corresponding to a particular structure.</p></li>
<li><p>When a direction converges successfully (e.g., “Direction 1
converges”), the algorithm checks if additional dimensions might exist
for this structure and proceeds to search for another
direction.</p></li>
<li><p>When a direction fails to converge (e.g., “Direction 2 does not
converge”), the algorithm concludes that it has found all significant
dimensions for the current structure and moves on to the next structure
type.</p></li>
<li><p>The process continues until all possible structures have been
examined (individual structures for each block and all possible
combinations of joint structures).</p></li>
</ol>
<p>At the end of the joint structure identification step, DIVAS
summarizes the results like this:</p>
<pre><code>Direction 1 converges.
There is no room for searching next direction. Stop searching current joint block.
There is no room for the next joint block. Stop searching.
The rank of joint block among X1, X2, X3: 1
The rank of joint block among X1, X2: 1
The rank of joint block among X1, X3: 1
The rank of joint block among X2, X3: 1
Starting binary code 1</code></pre>
<p>This summary shows the rank (number of dimensions) found for each
joint structure. In this example, DIVAS identified: - 1 dimension shared
among all three data blocks (X1, X2, X3) - 1 dimension shared between
each pair of data blocks (X1-X2, X1-X3, X2-X3)</p>
</div>
<div class="section level3">
<h3 id="step-3-structure-reconstruction">Step 3: Structure Reconstruction<a class="anchor" aria-label="anchor" href="#step-3-structure-reconstruction"></a>
</h3>
<p>In the final step, DIVAS reconstructs the estimated individual and
joint structures for each data block. This reconstruction provides a
decomposition of the original signal into its joint and individual
components.</p>
<p>The algorithm outputs (More explanations are summarized together in
the next Section):</p>
<pre><code>$jointBasisMap
$matLoadings
$matBlocks
$keyIdxMap</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="interpreting-the-visualization-results">Interpreting the Visualization Results<a class="anchor" aria-label="anchor" href="#interpreting-the-visualization-results"></a>
</h2>
<p>The DIVAS analysis generates two main diagnostic plots that provide
critical insights into the identified structures:</p>
<div class="section level3">
<h3 id="joint-structure-loadings-diagnostics">1. Joint Structure Loadings Diagnostics<a class="anchor" aria-label="anchor" href="#joint-structure-loadings-diagnostics"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># These plots are generated by the DJIVEAngleDiagnosticJP function</span></span>
<span><span class="co"># plots &lt;- DJIVEAngleDiagnosticJP(datablock_list, dataname, divas_results, </span></span>
<span><span class="co">#                               randseed = 566, titlestr = "Demo")</span></span></code></pre></div>
<p>This plot shows:</p>
<ul>
<li>
<strong>Rows</strong>: Each data block (DataBlock_1, DataBlock_2,
DataBlock_3)</li>
<li>
<strong>Columns</strong>: Different structure types (3-Way = shared
by all three blocks, 2-Way = pairwise joint structures, 1-Way =
individual structures)</li>
<li>
<strong>Numbers in cells</strong>: The rank (dimensionality) of each
structure type for each data block</li>
<li>
<strong>Colors</strong>: Blue for 3-Way joint structures, Red for
2-Way joint structures, Gray for individual structures</li>
<li>
<strong>Angles</strong>: Values like “78.4”, “8.6” represent
perturbation angles, with smaller angles indicating more stable
structures</li>
<li>
<strong>Bottom row</strong>: Shows the effective contribution of
each structure type to the overall signal</li>
</ul>
<p>In the example plot: - Each data block has a 1-dimensional structure
shared with all blocks (the “3-Way” column) - Each data block
participates in 1-dimensional pairwise joint structures (the “2-Way”
columns) - None of the blocks show individual structures (zeros in the
“1-Way” column) - The perturbation angles vary across blocks, with
DataBlock_3 showing the most stable joint structure (smallest angle of
2.8°)</p>
</div>
<div class="section level3">
<h3 id="joint-structure-score-diagnostics">2. Joint Structure Score Diagnostics<a class="anchor" aria-label="anchor" href="#joint-structure-score-diagnostics"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print(plots$score)</span></span></code></pre></div>
<p>This plot is similar to the loadings plot but focuses on the sample
space (scores) rather than the feature space (loadings). It shows:</p>
<ul>
<li>How the joint and individual structures manifest in the sample
dimensions</li>
<li>Principal angles (like “82”, “11.8”) between the identified
structures and random subspaces</li>
<li>The bottom row shows the “Effective Number of Cases” that contribute
to each structure</li>
</ul>
<p>Smaller angles in both plots indicate that the identified structures
are statistically significant and distinct from random variation.</p>
<p>These visualizations provide a comprehensive view of how information
is shared across data blocks, helping researchers identify which
structures are most important and reliable for interpretation.</p>
<p>Let’s examine the key components of the <code>divas_results</code>
object in detail:</p>
</div>
<div class="section level3">
<h3 id="joint-basis-map">Joint Basis Map<a class="anchor" aria-label="anchor" href="#joint-basis-map"></a>
</h3>
<p>The <code>jointBasisMap</code> is a list containing the estimated
basis vectors (scores) for each identified structure:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># names(divas_results$jointBasisMap)</span></span>
<span><span class="co"># dim(divas_results$jointBasisMap[["7"]])</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="matrix-loadings">Matrix Loadings<a class="anchor" aria-label="anchor" href="#matrix-loadings"></a>
</h3>
<p>The <code>matLoadings</code> component provides the corresponding
loadings for each structure:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># str(divas_results$matLoadings, max.level = 2)</span></span></code></pre></div>
<p>This nested list structure contains loadings for each block and each
structure. The loadings show how the joint and individual patterns are
expressed in the original feature space of each data block.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Prothero, J., …, Marron J. S. (2024). Data integration via
analysis of subspaces (DIVAS).</p></li>
<li><p>DIVAS R package. <a href="https://github.com/ByronSyun/DIVAS_Develop" class="external-link uri">https://github.com/ByronSyun/DIVAS_Develop</a>.</p></li>
<li><p>Klein, C., Hesse, S., Mao, J., Hadziahmetovic, A., et al. (2025).
A molecular atlas of human granulopoiesis. <a href="https://www.researchsquare.com/article/rs-6184761/v1" class="external-link uri">https://www.researchsquare.com/article/rs-6184761/v1</a></p></li>
<li><p>GNP dataset provided by the <a href="https://www.ccrc-hauner.de/mission/509ecab365bf4e16" class="external-link">Comprehensive
Childhood Research Center</a><br>
at the <a href="https://www.lmu-klinikum.de/hauner/kinder-und-kinderpoliklinik" class="external-link">Dr. von
Hauner Children’s Hospital</a> (<a href="https://www.ccrc-hauner.de/research-labs/klein-lab/939888339a9fcb00" class="external-link">Klein
Lab</a>). <a href="https://granulopoiesis.com/" class="external-link uri">https://granulopoiesis.com/</a></p></li>
</ol>
<p>For more detailed technical information about the DIVAS method,
please refer to the primary publication (1). For details on the R
package implementation, please visit the GitHub repository (2). The GNP
dataset used in Example 2 is from the human granulopoiesis atlas project
(3,4).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jiadong Mao, Yinuo Sun.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
