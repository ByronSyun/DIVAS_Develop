# DIVAS: Data Integration via Analysis of Subspaces

![DIVAS Logo](reference/figures/DIVAS_logo.png)

## Introduction

DIVAS (Data Integration via Analysis of Subspaces) is an R package for
multi-modal data integration. Based on the DIVAS methodology proposed by
Prothero et al. (2024), it provides tools for signal extraction, noise
estimation, and joint structure identification from high-dimensional
datasets, useful for multi-omics and other complex data types.

**Documentation website**: <https://byronsyun.github.io/DIVAS_Develop/>

## Installation

### Dependencies

The DIVAS package requires a modern version of the `CVXR` package to
ensure compatibility with underlying solvers like SCS. We strongly
recommend installing the latest stable version from CRAN.

``` r
# Install devtools (if not already installed)
install.packages("devtools")

# Install the latest version of CVXR from CRAN
# This is critical to avoid issues with solver status recognition (e.g., for SCS)
install.packages("CVXR")
```

### Installing the DIVAS package

You can install the development version of DIVAS from GitHub using
`devtools`:

``` r
# Install DIVAS package from the main branch on GitHub
devtools::install_github("ByronSyun/DIVAS_Develop/pkg", ref = "main")

# Or install from a local folder if you have cloned the repository
# devtools::install("path/to/DIVAS-main/pkg")
```

## Usage Examples

The DIVAS package supports analysis of various data formats. Here are
two examples using different data formats:

### Example 1: Using MATLAB data

``` r
# Load necessary libraries
library(devtools)
library(R.matlab)
library(DIVAS)

# Construct the path to the data file within the package
data_path <- system.file("extdata", "toyDataThreeWay.mat", package = "DIVAS")
# Read MATLAB data
data <- readMat(data_path)

# Prepare data blocks
datablock <- list(
  X1 = data$datablock[1,1][[1]][[1]],
  X2 = data$datablock[1,2][[1]][[1]],
  X3 = data$datablock[1,3][[1]][[1]]
)

# Run DIVAS main function
result <- DIVASmain(datablock)

# Visualize results
dataname <- paste0("DataBlock_", 1:length(datablock))
plots <- DJIVEAngleDiagnosticJP(datablock, dataname, result, 566, "Demo")
print(plots)
```

See the documentation website for more detailed examples and tutorials.

## Available Datasets

| Dataset              | Brief Description                                                                                         | Vignette Link                                                                                            | Format | Primary Reference      |
|----------------------|-----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|--------|------------------------|
| toyDataThreeWay.mat  | Synthetic 3-block data with known joint structures                                                        | [Toy Dataset Example](https://byronsyun.github.io/DIVAS_Develop/articles/DIVAS_Toy_Dataset_Example.html) | .mat   | Prothero et al. (2024) |
| gnp_imputed.qs       | GNP economic time series data                                                                             | [GNP Dataset Example](https://byronsyun.github.io/DIVAS_Develop/articles/DIVAS_GNP_Dataset_Example.html) | .qs    | Stock & Watson (2016)  |
| COVID-19 Multi-Omics | 6-block integration: scRNA-seq (4 cell types), proteomics, metabolomics from 114 COVID-19 patient samples | [COVID Case Study](https://byronsyun.github.io/DIVAS_COVID19_CaseStudy/)                                 | .rds   | Su et al. (2020)       |

## Case Study: COVID-19 Multi-Omics Analysis

This project serves as a comprehensive, real-world application of the
DIVAS package on a complex multi-omics dataset from a COVID-19 patient
cohort. It demonstrates the full data processing and analysis workflow,
from raw data cleaning to final DIVAS results, showcasing the practical
utility of the package.

**➡️ [View the full analysis on
GitHub](https://github.com/ByronSyun/DIVAS_COVID19_CaseStudy)**

## Developers

- **[Jiadong Mao](https://github.com/jiadongm)** - *Lead Developer,
  Maintainer*
- **[Yinuo Sun](https://github.com/ByronSyun)** - *Package Developer,
  Maintainer*

## References

Prothero, J., et al. (2024). Data integration via analysis of subspaces
(DIVAS).

Su, Y., Chen, D., Yuan, D., et al. (2020). Multi-Omics Resolves a Sharp
Disease-State Shift between Mild and Moderate COVID-19. Cell, 183(6),
1479-1495. <https://doi.org/10.1016/j.cell.2020.10.037>

## License

This project is licensed under the GNU Affero General Public License
v3.0 (AGPL-3) - see the LICENSE file for details.

# Package index

## Package Overview

- [`DIVAS`](https://byronsyun.github.io/DIVAS_Develop/reference/DIVAS-package.md)
  [`DIVAS-package`](https://byronsyun.github.io/DIVAS_Develop/reference/DIVAS-package.md)
  : DIVAS: Data Integration via Analysis of Subspaces

## Core Workflow Function

The main function to run the DIVAS analysis pipeline.

- [`DIVASmain()`](https://byronsyun.github.io/DIVAS_Develop/reference/DIVASmain.md)
  : Data integration via analysis of subspaces

## Signal Extraction Functions

Functions for extracting signals from data matrices.

- [`DJIVESignalExtractJP()`](https://byronsyun.github.io/DIVAS_Develop/reference/DJIVESignalExtractJP.md)
  : Signal Matrix Extraction for DIVAS
- [`MatSignalExtractJP()`](https://byronsyun.github.io/DIVAS_Develop/reference/MatSignalExtractJP.md)
  : Matrix Signal Extraction
- [`MedianMarcenkoPastur()`](https://byronsyun.github.io/DIVAS_Develop/reference/MedianMarcenkoPastur.md)
  : Calculate the Median of the Marčenko-Pastur Distribution
- [`PercentileMarcenkoPastur()`](https://byronsyun.github.io/DIVAS_Develop/reference/PercentileMarcenkoPastur.md)
  : Percentile of the Marcenko-Pastur Distribution
- [`incMarPas()`](https://byronsyun.github.io/DIVAS_Develop/reference/incMarPas.md)
  : Incomplete Marčenko-Pastur Distribution Function
- [`ksOpt()`](https://byronsyun.github.io/DIVAS_Develop/reference/ksOpt.md)
  : Optimal Shrinkage Estimation using Kolmogorov-Smirnov Criterion
- [`optimal_shrinkage()`](https://byronsyun.github.io/DIVAS_Develop/reference/optimal_shrinkage.md)
  : Optimal Shrinkage of Singular Values
- [`optshrink_impl()`](https://byronsyun.github.io/DIVAS_Develop/reference/optshrink_impl.md)
  : Optimal Shrinkage of Singular Values

## Joint Structure Estimation Functions

Functions for estimating joint and individual structures.

- [`DJIVEJointStrucEstimateJP()`](https://byronsyun.github.io/DIVAS_Develop/reference/DJIVEJointStrucEstimateJP.md)
  : Estimate full and partially shared joint structures Establish a DC
  programming problem to estimate each partially joint structure using
  Penalty CCP algorithm.

## Reconstruction Functions

Functions for reconstructing data based on identified structures.

- [`DJIVEReconstructMJ()`](https://byronsyun.github.io/DIVAS_Develop/reference/DJIVEReconstructMJ.md)
  : DJIVEReconstructMJ - Reconstruct joint blocks from data blocks
- [`MatReconstructMJ()`](https://byronsyun.github.io/DIVAS_Develop/reference/MatReconstructMJ.md)
  : MatReconstructMJ - Reconstruct joint block matrices and their
  loadings from data

## Diagnostic Functions

Functions for diagnosing and evaluating the DIVAS results.

- [`DJIVEAngleDiagnosticJP()`](https://byronsyun.github.io/DIVAS_Develop/reference/DJIVEAngleDiagnosticJP.md)
  : Create Diagnostic Plots for DJIVE Analysis
- [`randDirAngleMJ()`](https://byronsyun.github.io/DIVAS_Develop/reference/randDirAngleMJ.md)
  : Calculate Random Direction Angles

## Utility Functions

Helper functions for DIVAS workflow and result interpretation.

- [`MatCenterJP()`](https://byronsyun.github.io/DIVAS_Develop/reference/MatCenterJP.md)
  : Center a Matrix by Rows, Columns, or Both
- [`acosd()`](https://byronsyun.github.io/DIVAS_Develop/reference/acosd.md)
  : Arccosine in Degrees
- [`getTopFeatures()`](https://byronsyun.github.io/DIVAS_Develop/reference/getTopFeatures.md)
  : Extract Top Contributing Features for a DIVAS Component

# Articles

### All vignettes

- [DIVAS Vignette: GNP Dataset
  Example](https://byronsyun.github.io/DIVAS_Develop/articles/DIVAS_GNP_Dataset_Example.md):
- [DIVAS Vignette: Toy Dataset
  Example](https://byronsyun.github.io/DIVAS_Develop/articles/DIVAS_Toy_Dataset_Example.md):
- [DIVAS User Guide: Analysing the Toy
  Dataset](https://byronsyun.github.io/DIVAS_Develop/articles/DIVAS_User_Guide.md):
