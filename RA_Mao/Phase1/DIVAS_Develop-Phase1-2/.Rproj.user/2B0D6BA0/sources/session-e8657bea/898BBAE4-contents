library('DIVASpackage')
library(R.matlab)
# datablock <- data$datablock
data <- readMat('/Users/byronsun/Desktop/RA_Mao/R code DIVAS/Data/toyDataThreeWay.mat')

# datablocks from the list and convert to matrix
datablock <- lapply(data$datablock, function(x) x[[1]])
datablock <- matrix(list(datablock[[1]], datablock[[2]], datablock[[3]]), nrow = 1, ncol = 3)


dataname <- c('datablock1', 'datablock2', 'datablock3')
nsim <- 400
iplot <- 0
colCent <- 0
rowCent <- 0
cull <- 0.5
noisepercentile <- c(0.9, 0.85, 0.8) # not real

result <- DJIVESignalExtractJP(
  datablock = datablock,
  dataname = dataname,
  nsim = nsim,
  iplot = iplot,
  colCent = colCent,
  rowCent = rowCent,
  cull = cull,
  noisepercentile = noisepercentile
)


cat("Adjusted signal ranks (rBars):\n")
print(result$rBars)

cat("Perturbation angles (phiBars):\n")
print(result$phiBars)

cat("Loadings perturbation angles (psiBars):\n")
print(result$psiBars)

